<project default="default" xmlns:j="jelly:core" xmlns:u="jelly:util" >

  <goal name="default" prereqs="clean, groovy:compile-tests">
  </goal>	
  
  <goal name="setclasspath">
    <path id="test.classpath">
      <pathelement path="${maven.build.dest}"/>
      <pathelement path="target/classes"/>
      <pathelement path="target/test-classes"/>
      <path refid="maven.dependency.classpath"/>
    </path>
    <taskdef name="groovyc" classname="org.codehaus.groovy.ant.Groovyc" classpathref="test.classpath"/> 
  </goal>
  
  <goal name="groovy:compile" prereqs="java:compile, setclasspath" description="Compiles the main code">
    <copy todir="${basedir}/target/classes">
      <fileset dir="${basedir}/src/main">
        <include name="**/*.groovy"/>
        <exclude name="CVS/*"/>
      </fileset>
    </copy>
    <groovyc destdir="${basedir}/target/classes" srcdir="${basedir}/target/classes" listfiles="true">
      <classpath refid="test.classpath"/>
    </groovyc>
  </goal>
  
  <goal name="groovy:compile-tests" prereqs="groovy:compile, setclasspath" description="Compiles the test cases">
    <mkdir dir="${basedir}/target/test-classes"/>
    <copy todir="${basedir}/target/test-classes">
      <fileset dir="${basedir}/src/test">
        <include name="**/*.groovy"/>
        <exclude name="**/notworking/*.groovy"/>
        <exclude name="**/parser/*.groovy"/>
        <exclude name="CVS/*"/>
      </fileset>
    </copy>
    <touch>
		<fileset dir="${basedir}/target/test-classes" includes="**/*.groovy"/>
    </touch>
    <groovyc destdir="${basedir}/target/test-classes" srcdir="${basedir}/target/test-classes" listfiles="true">
      	<classpath refid="test.classpath"/>
    </groovyc>
  </goal>

  
</project>
